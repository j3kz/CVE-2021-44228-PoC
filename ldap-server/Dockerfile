FROM alpine/git AS clone
WORKDIR /github.com/mbechler
RUN git clone https://github.com/mbechler/marshalsec

FROM maven:3.8.4-openjdk-8-slim AS build
COPY --from=clone /github.com/mbechler/marshalsec /github.com/mbechler/marshalsec
WORKDIR /github.com/mbechler/marshalsec
RUN mvn clean package -DskipTests

FROM openjdk:8u191-jdk-alpine
WORKDIR /app
COPY --from=build /github.com/mbechler/marshalsec/target/marshalsec-0.0.3-SNAPSHOT-all.jar /app
ENTRYPOINT [ "java", "-cp",  "marshalsec-0.0.3-SNAPSHOT-all.jar",  "marshalsec.jndi.LDAPRefServer" ]
